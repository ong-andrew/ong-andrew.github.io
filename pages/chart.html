<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Visitors Chart</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
</head>
<body>
    <div id="container" style="width:100%; height:400px;"></div>
    <div id="checkbox-container" style="width: 100%; max-width: 300px; height: 150px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;"></div>

    <script>
        $(document).ready(function() {
            // Load CSV data
            $.get('data.csv', function(data) {
                const lines = data.split('\n').slice(1); // Skip header
                const seriesData = {};
                const websites = new Set(); // To store unique websites

                lines.forEach(line => {
                    const [date, website, visitors] = line.split(',');
                    if (!seriesData[website]) {
                        seriesData[website] = [];
                    }
                    // Parse the date in DD/MM/YYYY format
                    const [day, month, year] = date.split('/').map(Number);
                    const timestamp = new Date(year, month - 1, day).getTime(); // Correctly convert to timestamp
                    seriesData[website].push([timestamp, parseInt(visitors)]);
                    websites.add(website); // Add website to the set
                });

                // Predefined websites to check
                const preselectedWebsites = ['malaysiakini.com', 'thestar.com.my', 'hmetro.com.my'];

                // Generate checkboxes for each website
                websites.forEach(website => {
                    const isChecked = preselectedWebsites.includes(website) ? 'checked' : '';
                    $('#checkbox-container').append(`<label><input type="checkbox" value="${website}" ${isChecked}> ${website}</label><br>`);
                });

                // Initialize chart with only visible series
                const chart = Highcharts.chart('container', {
                    title: {
                        text: 'Website Visitors Over Time', // Added chart title
                        align: 'left'
                    },
                    xAxis: { type: 'datetime' },
                    yAxis: { title: { text: 'Visitors' } },
                    series: Object.keys(seriesData).map(website => ({
                        name: website,
                        data: seriesData[website],
                        visible: preselectedWebsites.includes(website)
                    })).filter(series => series.visible),
                    credits: {
                        enabled: true,
                        text: 'Source: similarwebs.com',
                        href: null,

                    },
                    plotOptions: {
                        series: {
                            label: {
                                enabled: true,
                                connectorAllowed: false
                            }
                        }
                    },


                    legend: {
                        align: 'left',
                        verticalAlign: 'top',
                        layout: 'horizontal'
                    }
                });

                // Checkbox event handler
                $('input[type="checkbox"]').change(function() {
                    const website = $(this).val();
                    const series = chart.series.find(s => s.name === website);

                    if (this.checked) {
                        if (!series) {
                            chart.addSeries({
                                name: website,
                                data: seriesData[website],
                                visible: true
                            });
                        } else {
                            series.setVisible(true);
                        }
                    } else {
                        if (series) {
                            series.setVisible(false);
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>